{
    "collab_server" : "",
    "contents" : "library(dplyr)\nlibrary(reshape2)\nlibrary(ggplot2)\nlibrary(plotly)\nlibrary(scales)\nlibrary(RCurl)\nlibrary(ggthemes)\nlibrary(treemap)\n\n#Load data, upgrade to pull from google sheets\nzeroTo2   <- getURL('https://docs.google.com/spreadsheets/d/1c_FBfXw_Oq-p5ocYx5wnHqnA-7dTI01tx7J7YszytsI/pub?gid=0&single=true&output=csv')\nthreeTo5  <- getURL('https://docs.google.com/spreadsheets/d/10TEwPj-fRlb0kaCFJM86pudOpKObacBXhl4I4Cz6r90/pub?gid=0&single=true&output=csv')     \nother     <- getURL('https://docs.google.com/spreadsheets/d/1P9jRvModlmzReivw9Gljt-qv9T1hlW9brhTEPgvMRoI/pub?gid=0&single=true&output=csv')\nsoc       <- getURL('https://docs.google.com/spreadsheets/d/1wWVpXkU7OG2dGjCEEOK4Z4sS02tgK9_zee9cl0MdQRE/pub?gid=0&single=true&output=csv')\n\nbusiness0to2      <- read.csv(textConnection(zeroTo2))\nbusiness3to5      <- read.csv(textConnection(threeTo5))\nbusinessOther     <- read.csv(textConnection(other))\nmajorSocCodeNames <- read.csv(textConnection(soc))\n\n# https://docs.google.com/spreadsheets/d/1c_FBfXw_Oq-p5ocYx5wnHqnA-7dTI01tx7J7YszytsI/pub?gid=0&single=true&output=csv\n\n#business3to5       <- read.csv('business3to5.csv')\n#businessOther      <- read.csv('businessOther.csv')\n#majorSocCodeNames  <- read.csv('socMajorOccupationGroupsBLS_2010.csv')\n\n#Merge data\nall <- full_join(business0to2, business3to5, by = 'SOC')\nall <- full_join(all, businessOther,         by = 'SOC')\n\n#Seperate first two numbers of SOC codes and put in new variable\nsplitSOC <- as.data.frame(t(sapply(all$SOC, function(x) substring(x, first=c(1, 1), last=c(2, 7)))))\n       #Change column names \n       colnames(splitSOC)[1] <- \"socGroup\"\n       colnames(splitSOC)[2] <- \"SOC\"\n       colnames(majorSocCodeNames)[1] <- 'socGroup'\n\n#filter to necessary variables only \nall <- all %>% \n       select(1,2,3,5,7)\n\n#Add soc group codes       \nall <- full_join(all, splitSOC, by = 'SOC')\n\n#Count by Soc group for each level of experience\nsocGroup0to2 <- count(all, socGroup, wt = zeroTo2yearsExperience)\n       colnames(socGroup0to2)[2] <- \"0-2 years\"\nsocGroup3to5 <- count(all, socGroup, wt = threeToFiveYearsExperience)\n       colnames(socGroup3to5)[2] <- \"3-5 years\"\nsocGroupOther <- count(all, socGroup, wt = Other)\n       colnames(socGroupOther)[2] <- \"Other\"\n \n#Create data table with count of experience levels by the major soc group     \nxy <- full_join(socGroup0to2, socGroup3to5, by = 'socGroup')\nxy <- full_join(xy, socGroupOther, by = 'socGroup')\n\n#Convert Soc Groups to factors\nmajorSocCodeNames$socGroup <- as.factor(majorSocCodeNames$socGroup)\nxy$socGroup <- as.factor(xy$socGroup)\n\n#Join to SOC code names \nxy <- left_join(xy, majorSocCodeNames, by = 'socGroup')\n\nxy <- xy %>%\n       filter(socGroup != 27 & socGroup != 53 & socGroup != 19 \n              & socGroup != 23 & socGroup != 35 & socGroup != 33\n              & socGroup != 25 & socGroup != 25 & socGroup != 21)\n\n#change to numeric \nxy$`0-2 years` <- as.numeric(as.character(xy$`0-2 years`))\nxy$`3-5 years` <- as.numeric(as.character(xy$`3-5 years`))\nxy$Other <- as.numeric(as.character(xy$Other))\n\n\n\n#Add calculation for percentages\nxy$zeroTo2percent  <- (xy$`0-2 years`)/(xy$`0-2 years` + xy$`3-5 years` + xy$Other)\nxy$threeTo5percent <- (xy$`3-5 years`)/(xy$`0-2 years` + xy$`3-5 years` + xy$Other)\nxy$otherPercent    <- (xy$Other)/(xy$`0-2 years` + xy$`3-5 years` + xy$Other)\n\n\nrawData     <- xy %>%\n                select(1:5)\n\npercentData <- xy %>%\n                select(1, 5:8)\n\nrawData     <- melt(rawData)\npercentData <- melt(percentData)\n\nallData <- cbind(percentData, rawData)\n\ncolnames(allData)[1] <- 'SOC'\ncolnames(allData)[2] <- 'Occupations'\ncolnames(allData)[3] <- 'Percent Type'\ncolnames(allData)[4] <- 'Percent'\ncolnames(allData)[6] <- 'occ'\ncolnames(allData)[7] <- 'Experience'\ncolnames(allData)[8] <- 'Jobs'\n\nallData <- allData %>%\n       select(1:4, 7:8)\ntotals <- count(allData, Occupations, wt = Jobs, sort = TRUE)\nallData <- full_join(allData, totals, by = 'Occupations')\nallData <- allData %>%\n              arrange(n)\n\nOccupation <- reorder(allData$Occupations, allData$n)\n#Visualize\ng <- ggplot(allData, aes(x = Occupation, \n                            y = Jobs, \n                            fill = Experience, \n                            label = Percent)) +      \n              geom_bar(stat = 'identity') +\n              labs(x = '', \n                   y = 'Number of Job Postings') +\n              coord_flip() +\n              theme_minimal()\nggplotly(g)\n\n\n#+ scale_y_continuous(labels = percent)\n\n#plot_ly(all,  x = ~zeroTo2yearsExperience, y = ~Occupation.Title.x, type = 'bar', name = '0 - 2 years experience') %>%\n#       add_trace(x = ~threeToFiveYearsExperience, name = '3 - 5 years experience') %>%\n#       layout(yaxis = list(title = 'Count'), barmode = 'stack') + \n\n#treemap(all, index = 'Occupation.Title.x', vSize = 'Other')\n\n\nwrite.csv(xy, file = 'businessExperienceRatio.csv')\n",
    "created" : 1476995314480.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "894065264",
    "id" : "9F2F608A",
    "lastKnownWriteTime" : 1476999633,
    "last_content_update" : 1476999633212,
    "path" : "~/Desktop/rProjects/rstudioWork/bachelorsPlusOccupations/experienceRatio.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}