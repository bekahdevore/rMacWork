{
    "collab_server" : "",
    "contents" : "\n# This is the server logic for a Shiny web application.\n# You can find out more about building applications with Shiny here:\n#\n# http://shiny.rstudio.com\n#\n\nlibrary(shiny)\n\nlibrary(dplyr)\nlibrary(reshape2)\nlibrary(ggplot2)\nlibrary(plotly)\nlibrary(scales)\nlibrary(RCurl)\nlibrary(ggthemes)\nlibrary(treemap)\n\n#Load data, upgrade to pull from google sheets\nzeroTo2   <- getURL('https://docs.google.com/spreadsheets/d/1P9jRvModlmzReivw9Gljt-qv9T1hlW9brhTEPgvMRoI/pub?gid=1488961162&single=true&output=csv')\nthreeTo5  <- getURL('https://docs.google.com/spreadsheets/d/1P9jRvModlmzReivw9Gljt-qv9T1hlW9brhTEPgvMRoI/pub?gid=1835285205&single=true&output=csv')     \nother     <- getURL('https://docs.google.com/spreadsheets/d/1P9jRvModlmzReivw9Gljt-qv9T1hlW9brhTEPgvMRoI/pub?gid=1447056049&single=true&output=csv')\nsoc       <- getURL('https://docs.google.com/spreadsheets/d/1wWVpXkU7OG2dGjCEEOK4Z4sS02tgK9_zee9cl0MdQRE/pub?gid=0&single=true&output=csv')\n\nbusiness0to2      <- read.csv(textConnection(zeroTo2))\nbusiness3to5      <- read.csv(textConnection(threeTo5))\nbusinessOther     <- read.csv(textConnection(other))\nmajorSocCodeNames <- read.csv(textConnection(soc))\n\n# https://docs.google.com/spreadsheets/d/1c_FBfXw_Oq-p5ocYx5wnHqnA-7dTI01tx7J7YszytsI/pub?gid=0&single=true&output=csv\n\n#business3to5       <- read.csv('business3to5.csv')\n#businessOther      <- read.csv('businessOther.csv')\n#majorSocCodeNames  <- read.csv('socMajorOccupationGroupsBLS_2010.csv')\n\n#Merge data\nall <- full_join(business0to2, business3to5, by = 'SOC')\nall <- full_join(all, businessOther,         by = 'SOC')\n\n#Seperate first two numbers of SOC codes and put in new variable\nsplitSOC <- as.data.frame(t(sapply(all$SOC, function(x) substring(x, first=c(1, 1), last=c(2, 7)))))\n#Change column names \ncolnames(splitSOC)[1] <- \"socGroup\"\ncolnames(splitSOC)[2] <- \"SOC\"\ncolnames(majorSocCodeNames)[1] <- 'socGroup'\n\n#filter to necessary variables only \nall <- all %>% \n  select(1,2,3,5,7)\n\n#Add soc group codes       \nall <- full_join(all, splitSOC, by = 'SOC')\n\n#Count by Soc group for each level of experience\nsocGroup0to2 <- count(all, socGroup, wt = zeroTo2yearsExperience)\ncolnames(socGroup0to2)[2] <- \"0-2 years\"\nsocGroup3to5 <- count(all, socGroup, wt = threeToFiveYearsExperience)\ncolnames(socGroup3to5)[2] <- \"3-5 years\"\nsocGroupOther <- count(all, socGroup, wt = Other)\ncolnames(socGroupOther)[2] <- \"6 or more\"\n\n#Create data table with count of experience levels by the major soc group     \nxy <- full_join(socGroup0to2, socGroup3to5, by = 'socGroup')\nxy <- full_join(xy, socGroupOther, by = 'socGroup')\n\n#Convert Soc Groups to factors\nmajorSocCodeNames$socGroup <- as.factor(majorSocCodeNames$socGroup)\nxy$socGroup <- as.factor(xy$socGroup)\n\n#Join to SOC code names \nxy <- left_join(xy, majorSocCodeNames, by = 'socGroup')\n\nxy <- xy %>%\n  filter(socGroup != 27 & socGroup != 53 & socGroup != 19 \n         & socGroup != 23 & socGroup != 35 & socGroup != 33\n         & socGroup != 25 & socGroup != 25 & socGroup != 21)\n\n#change to numeric \nxy$`0-2 years` <- as.numeric(as.character(xy$`0-2 years`))\nxy$`3-5 years` <- as.numeric(as.character(xy$`3-5 years`))\nxy$`6 or more` <- as.numeric(as.character(xy$`6 or more`))\n\n\n## NEED TO CALCULATE PERCENTAGES BY GROUP \n#Add calculation for percentages\nxy$zeroTo2percent  <- (xy$`0-2 years`)/(xy$`0-2 years` + xy$`3-5 years` + xy$`6 or more`)\nxy$threeTo5percent <- (xy$`3-5 years`)/(xy$`0-2 years` + xy$`3-5 years` + xy$`6 or more`)\nxy$otherPercent    <- (xy$`6 or more`)/(xy$`0-2 years` + xy$`3-5 years` + xy$`6 or more`)\n\n\nrawData     <- xy %>%\n                select(1:5)\n\npercentData <- xy %>%\n                select(1, 5:8)\n\nrawData     <- melt(rawData)\npercentData <- melt(percentData)\n\nallData <- full_join(percentData, rawData, by = \"socGroup\")\n\ncolnames(allData)[1] <- 'SOC'\ncolnames(allData)[2] <- 'Occupations'\ncolnames(allData)[3] <- 'Percent Type'\ncolnames(allData)[5] <- 'Percent'\ncolnames(allData)[6] <- 'occ'\ncolnames(allData)[7] <- 'Experience'\ncolnames(allData)[8] <- 'Jobs'\n\nallData <- allData %>%\n  select(1:5, 7:8)\ntotals <- count(allData, Occupations, wt = Jobs, sort = TRUE)\nallData <- full_join(allData, totals, by = 'Occupations')\nallData <- allData %>%\n  arrange(n)\n\nOccupation <- reorder(allData$Occupations, allData$n)\n\n#Visualize\n\ng <- ggplot(allData, aes(x = Occupation, \n                         y = Jobs, \n                         fill = Experience)) +      \n  geom_bar(stat = 'identity') +\n  labs(x = '', \n       y = 'Number of Job Postings') +\n  coord_flip() +\n  theme_minimal()\n\nshinyServer(function(input, output) {\n\n  output$distPlot <- renderPlotly({\n    \n    ggplotly(g)\n    \n  })\n  \n  output$value <- renderPlot({\n    allData <- allData %>%\n                filter(Experience == input$select)\n    \n    allData$label <- paste(allData$Occupations, \n                           allData$Jobs,  \n                           sep = '\\n') \n    \n    treemap(allData, index = 'label', vSize = 'Jobs',\n            vColor = 'n',\n            title = '')\n  })\n})\n",
    "created" : 1476995297369.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4289081457",
    "id" : "CF033CDB",
    "lastKnownWriteTime" : 1482333245,
    "last_content_update" : 1482333269716,
    "path" : "/Volumes/admin_shared$/Bekah.Data/rProjects/shinyBusiness/server.R",
    "project_path" : "server.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}